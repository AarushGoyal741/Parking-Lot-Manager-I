<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Summary</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='summary.css') }}">
</head>
<body>

<div class="navbar">
    <a href="{{ url_for('home') }}">üè† Home</a>
    <a href="{{ url_for('user_summary') }}">üìä Summary</a>
    <a href="{{ url_for('logout') }}">Logout</a>
</div>

<div class="dashboard">
    <h2>üìä Your Parking Summary</h2>

    <div class="cards">
        <div class="card">
            <h3>Total Bookings</h3>
            <p>{{ total_bookings }}</p>
        </div>
        <div class="card">
            <h3>Active Booking</h3>
            <p>{{ 'Yes' if active_booking else 'No' }}</p>
        </div>
        <div class="card">
            <h3>Total Amount Spent</h3>
            <p>‚Çπ{{ "%.2f"|format(total_spent) }}</p>
        </div>
        <div class="card">
            <h3>Avg. Parking Time</h3>
            <p>
                {% if avg_duration %}
                    {{ "%.2f"|format(avg_duration) }} hours
                {% else %}
                    ‚Äî
                {% endif %}
            </p>
        </div>
    </div>
    <h3 style="margin-top: 40px;">üßæ Recent Bookings</h3>
    <table class="txn-table">
        <thead>
            <tr>
                <th>Spot ID</th>
                <th>Location</th>
                <th>Vehicle</th>
                <th>Entry Time</th>
                <th>Exit Time</th>
                <th>Cost</th>
                <th>Rating</th>

            </tr>
        </thead>
        <tbody>
            {% for txn in recent_txns %}
            {% set entry_ist = txn.entry_time + timedelta(hours=5, minutes=30) %}
            {% set leave_ist = txn.leave_time + timedelta(hours=5, minutes=30) if txn.leave_time else None %}
            <tr>
                <td>{{ txn.p_spot.spot_id }}</td>
                <td>{{ txn.p_spot.p_lot.loc }}</td>
                <td>{{ txn.vehicle_number or '‚Äî' }}</td>
                <td>{{ entry_ist.strftime('%Y-%m-%d %H:%M') }} <span class="ist">(IST)</span></td>
                <td>
                    {% if leave_ist %}
                        {{ leave_ist.strftime('%Y-%m-%d %H:%M') }} <span class="ist">(IST)</span>
                    {% else %}
                        <span style="color: orange;">Active</span>
                    {% endif %}
                </td>
                <td>
                    {% if txn.cost %}
                        ‚Çπ{{ "%.2f"|format(txn.cost) }}
                    {% else %}
                        ‚Äî
                    {% endif %}
                </td>
                <td>
                    {% if txn.rating %}
                        {{ txn.rating }} ‚òÖ
                    {% else %}
                        ‚Äî
                    {% endif %}
                </td>

            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>

<h3 style="margin-top: 40px;">üìà Booking Cost Chart</h3>
<div style="display: flex; justify-content: center; margin-top: 30px;">
  <div style="width: 600px;">
    <canvas id="costChart"></canvas>
  </div>
</div>



<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const labels = {{ labels|tojson }};
  const data = {{ costs|tojson }};

  const ctx = document.getElementById('costChart').getContext('2d');
  const costChart = new Chart(ctx, {
      type: 'bar',
      data: {
          labels: labels,
          datasets: [{
              label: '‚Çπ Cost per Booking',
              data: data,
              backgroundColor: 'rgba(54, 162, 235, 0.6)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 1,
              barThickness: 40  // Optional: Fix bar width
          }]
      },
      options: {
          scales: {
              y: {
                  beginAtZero: true,
                  suggestedMax: Math.max(...data) + 20
              }
          }
      }
  });
</script>



</body>
</html>
